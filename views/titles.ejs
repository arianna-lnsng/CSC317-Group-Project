<%- include('./partials/header') %>

<section class="title-detail">
  <h1><%= title.name %> (<%= title.releaseYear %>)</h1>
  <img src="<%= title.imageUrl %>" alt="<%= title.name %>" />

  <p><strong>Director:</strong> <%= title.director %></p>
  <p><strong>Duration:</strong> <%= title.duration %> min</p>
  <p><strong>Genre:</strong> <%= title.genre %></p>
  <p><strong>Average Rating:</strong> 
    <%= typeof title.averageRating === 'number' ? title.averageRating.toFixed(1) : '0.0' %> / 5
  </p>

  <!-- ⭐ Rating form -->
  <form action="/titles/<%= title._id %>/rate" method="POST">
    <label for="rating">Rate this film:</label>
    <select name="rating" required>
      <option disabled selected>Choose</option>
      <option value="1">1 ★</option>
      <option value="2">2 ★</option>
      <option value="3">3 ★</option>
      <option value="4">4 ★</option>
      <option value="5">5 ★</option>
    </select>
    <button type="submit">Submit Rating</button>
  </form>
</section>

<hr>

<!--  Reviews section -->
<section class="reviews">
  <h2>Reviews</h2>
  <% if (reviews.length > 0) { %>
    <% reviews.forEach(review => { %>
      <div class="review">
        <strong><%= review.user?.username || 'Anonymous' %></strong>
        <h4><%= review.title %></h4>
        <p><%= review.content %></p>
      </div>
    <% }) %>
  <% } else { %>
    <p>No reviews yet. Be the first!</p>
  <% } %>

  <!-- ✍️ Review form -->
  <form action="/titles/<%= title._id %>/reviews" method="POST">
    <input type="text" name="reviewTitle" placeholder="Review Title" required />
    <textarea name="content" placeholder="Your review..." required></textarea>
    <button type="submit">Post Review</button>
  </form>
</section>

<hr>

<!-- Related Titles -->
<section class="related-titles">
  <h2>You might also like</h2>
  <% relatedTitles.forEach(movie => { %>
    <div class="related-card">
      <a href="/titles/<%= movie._id %>">
        <img src="<%= movie.imageUrl %>" alt="<%= movie.name %>" />
        <p><%= movie.name %></p>
      </a>
    </div>
  <% }) %>
</section>

<%- include('./partials/footer') %>
